var Panopticon=function(e){this.init(e)};Panopticon.prototype={init:function(e){return this.b(e),this.r(),this.h({type:"pageLoad",target:{id:null}},this.z),this},b:function(e){this.z={updateTimer:"number"==typeof e.updateTimer?e.updateTimer:2e3,endpoint:e.collector+"/pushEvents",gUrl:e.collector+"/startSession",siteId:e.siteId,ready:!1,cookie:"psess"},this.fz(this.z)},r:function(){var t=this;t.z.k=[],t.z.timer=setInterval(function(e){t.sendEvents(t.z)},t.z.updateTimer),document.addEventListener("click",function(e){t.h(e,t.z)}),document.addEventListener("blur",function(e){t.h(e,t.z)}),document.addEventListener("wheel",function(e){t.h(e,t.z)}),window.addEventListener("beforeunload",function(e){t.sendEvents(t.z)})},fz:function(n){var e=this.getCookie(n.cookie);if(e)return n.g=e,void(n.ready=!0);var t=new XMLHttpRequest;t.open("GET",n.gUrl),t.onreadystatechange=function(e){var t=e.target;4===t.readyState&&200===t.status&&(document.cookie="psess="+t.responseText,n.g=t.responseText,n.ready=!0)},t.send()},getCookie:function(e){var t=("; "+document.cookie).split("; "+e+"=");if(2==t.length)return t.pop().split(";").shift()},sendEvents:function(e){var t,n;e.ready&&e.k&&0!==e.k.length&&(t={siteId:e.siteId,sessionId:e.g,events:e.k.slice()},e.k=[],(n=new XMLHttpRequest).open("PUT",e.endpoint),n.setRequestHeader("Content-Type","application/json"),n.send(JSON.stringify(t)))},h:function(e,t){var n={path:window.location.pathname,query:window.location.search,fragment:window.location.hash.substr(1),eventTime:(new Date).toISOString(),elementId:e.target.id,eventType:e.type,x:e.pageX,y:e.pageY};t.k.push(n)}};